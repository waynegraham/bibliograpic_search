/**
 * jQuery Lightbox
 * @author Warren Krewenki
 *
 * This package is distributed under the BSD license.
 * For full license information, see LICENSE.TXT
 *
 * Based on Lightbox 2 by Lokesh Dhakar (http://www.huddletogether.com/projects/lightbox2/)
 *
 *
 **/


(function(a){a.fn.lightbox=function(b){function d(){if(a("#overlay, #lightbox").remove(),c.inprogress=!1,c.jsonData&&c.jsonData.length>0){var b=c.jsonDataParser?c.jsonDataParser:a.fn.lightbox.parseJsonData;c.imageArray=[],c.imageArray=b(c.jsonData)}var d='<div id="outerImageContainer"><div id="imageContainer"><iframe id="lightboxIframe"></iframe><img id="lightboxImage" /><div id="hoverNav"><a href="javascript://" title="'+c.strings.prevLinkTitle+'" id="prevLink"></a><a href="javascript://" id="nextLink" title="'+c.strings.nextLinkTitle+'"></a></div><div id="loading"><a href="javascript://" id="loadingLink"><img src="'+c.fileLoadingImage+'"></a></div></div></div>',e='<div id="imageDataContainer" class="clearfix"><div id="imageData"><div id="imageDetails"><span id="caption"></span><span id="numberDisplay"></span></div><div id="bottomNav">';c.displayHelp&&(e+='<span id="helpDisplay">'+c.strings.help+"</span>"),e+='<a href="javascript://" id="bottomNavClose" title="'+c.strings.closeTitle+'"><img src="'+c.fileBottomNavCloseImage+'"></a></div></div></div>';var f;return c.navbarOnTop?(f='<div id="overlay"></div><div id="lightbox">'+e+d+"</div>",a("body").append(f),a("#imageDataContainer").addClass("ontop")):(f='<div id="overlay"></div><div id="lightbox">'+d+e+"</div>",a("body").append(f)),c.imageScroll===!0&&a("#lightbox").css("position","fixed"),a("#overlay, #lightbox").click(function(){l()}).hide(),a("#loadingLink, #bottomNavClose").click(function(){return l(),!1}),a("#outerImageContainer").width(c.widthCurrent).height(c.heightCurrent),a("#imageDataContainer").width(c.widthCurrent),c.imageClickClose||(a("#lightboxImage").click(function(){return!1}),a("#hoverNav").click(function(){return!1})),!0}function e(){var b=Array(a(document).width(),a(document).height(),a(window).width(),a(window).height());return b}function f(){var a,b;self.pageYOffset?(b=self.pageYOffset,a=self.pageXOffset):document.documentElement&&(document.documentElement.scrollTop||document.documentElement.scrollLeft)?(b=document.documentElement.scrollTop,a=document.documentElement.scrollLeft):document.body&&(b=document.body.scrollTop,a=document.body.scrollLeft);var c=Array(a,b);return c}function g(b){if(a("select, embed, object").hide(),q(),a("#overlay").hide().css({opacity:c.overlayOpacity}).fadeIn(),imageNum=0,c.jsonData||(c.imageArray=[],b.rel&&""!=b.rel||c.allSet?a("a").each(function(){this.href&&this.rel==b.rel&&c.imageArray.push(Array(this.href,c.displayTitle?this.title:""))}):c.imageArray.push(Array(b.href,c.displayTitle?b.title:""))),c.imageArray.length>1){for(i=0;c.imageArray.length>i;i++)for(j=c.imageArray.length-1;j>i;j--)c.imageArray[i][0]==c.imageArray[j][0]&&c.imageArray.splice(j,1);for(;c.imageArray[imageNum][0]!=b.href;)imageNum++}var d=f(),e=d[1]+a(window).height()/10,g=d[0];a("#lightbox").css({top:e+"px",left:g+"px"}).show(),c.slideNavBar||a("#imageData").hide(),h(imageNum)}function h(b){0==c.inprogress&&(c.inprogress=!0,c.activeImage=b,a("#loading").show(),a("#lightboxImage, #hoverNav, #prevLink, #nextLink").hide(),c.slideNavBar&&(a("#imageDataContainer").hide(),a("#imageData").hide()),k())}function k(){var b=new Image;b.onload=function(){var d=b.width,f=b.height;if(c.scaleImages&&(d=parseInt(c.xScale*d),f=parseInt(c.yScale*f)),c.fitToScreen){var g=e(),i=g[2]-2*c.borderSize,j=g[3]-200,k=i/j,l=b.width/b.height;(b.height>j||b.width>i)&&(k>l?(d=parseInt(j/b.height*b.width),f=j):(f=parseInt(i/b.width*b.height),d=i))}a("#lightboxImage").attr("src",c.imageArray[c.activeImage][0]).width(d).height(f),n(d,f)},b.src=c.imageArray[c.activeImage][0]}function l(){u(),a("#lightbox").hide(),a("#overlay").fadeOut(),a("select, object, embed").show()}function m(){var a,b;c.loopImages&&c.imageArray.length>1?(b=new Image,b.src=c.imageArray[c.activeImage==c.imageArray.length-1?0:c.activeImage+1][0],a=new Image,a.src=c.imageArray[0==c.activeImage?c.imageArray.length-1:c.activeImage-1][0]):(c.imageArray.length-1>c.activeImage&&(b=new Image,b.src=c.imageArray[c.activeImage+1][0]),c.activeImage>0&&(a=new Image,a.src=c.imageArray[c.activeImage-1][0]))}function n(b,d){c.widthCurrent=a("#outerImageContainer").outerWidth(),c.heightCurrent=a("#outerImageContainer").outerHeight();var e=Math.max(350,b+2*c.borderSize),f=d+2*c.borderSize;wDiff=c.widthCurrent-e,hDiff=c.heightCurrent-f,a("#imageDataContainer").animate({width:e},c.resizeSpeed,"linear"),a("#outerImageContainer").animate({width:e},c.resizeSpeed,"linear",function(){a("#outerImageContainer").animate({height:f},c.resizeSpeed,"linear",function(){o()})}),afterTimeout=function(){a("#prevLink").height(d),a("#nextLink").height(d)},0==hDiff&&0==wDiff?setTimeout(afterTimeout,100):afterTimeout()}function o(){a("#loading").hide(),a("#lightboxImage").fadeIn("fast"),p(),m(),c.inprogress=!1}function p(){if(a("#numberDisplay").html(""),c.imageArray[c.activeImage][1]&&a("#caption").html(c.imageArray[c.activeImage][1]).show(),c.imageArray.length>1){var b;b=c.strings.image+(c.activeImage+1)+c.strings.of+c.imageArray.length,c.displayDownloadLink&&(b+="<a href='"+c.imageArray[c.activeImage][0]+"'>"+c.strings.download+"</a>"),c.disableNavbarLinks||((c.activeImage>0||c.loopImages)&&(b='<a title="'+c.strings.prevLinkTitle+'" href="#" id="prevLinkText">'+c.strings.prevLinkText+"</a>"+b),(c.activeImage+1<c.imageArray.length||c.loopImages)&&(b+='<a title="'+c.strings.nextLinkTitle+'" href="#" id="nextLinkText">'+c.strings.nextLinkText+"</a>")),a("#numberDisplay").html(b).show()}c.slideNavBar?a("#imageData").slideDown(c.navBarSlideSpeed):a("#imageData").show(),q(),r()}function q(){a("#overlay").css({width:a(document).width(),height:a(document).height()})}function r(){c.imageArray.length>1&&(a("#hoverNav").show(),c.loopImages?(a("#prevLink,#prevLinkText").show().click(function(){return h(0==c.activeImage?c.imageArray.length-1:c.activeImage-1),!1}),a("#nextLink,#nextLinkText").show().click(function(){return h(c.activeImage==c.imageArray.length-1?0:c.activeImage+1),!1})):(0!=c.activeImage&&a("#prevLink,#prevLinkText").show().click(function(){return h(c.activeImage-1),!1}),c.activeImage!=c.imageArray.length-1&&a("#nextLink,#nextLinkText").show().click(function(){return h(c.activeImage+1),!1}))),t()}function s(a){var b=a.data.opts,d=a.keyCode,e=27,f=String.fromCharCode(d).toLowerCase();"x"==f||"o"==f||"c"==f||d==e?l():"p"==f||37==d?b.loopImages?(u(),h(0==b.activeImage?b.imageArray.length-1:b.activeImage-1)):0!=b.activeImage&&(u(),h(b.activeImage-1)):("n"==f||39==d)&&(c.loopImages?(u(),h(b.activeImage==b.imageArray.length-1?0:b.activeImage+1)):b.activeImage!=b.imageArray.length-1&&(u(),h(b.activeImage+1)))}function t(){a(document).bind("keydown",{opts:c},s)}function u(){a(document).unbind("keydown")}var c=a.extend({},a.fn.lightbox.defaults,b);return a(window).resize(q),a(this).on(c.triggerEvent,function(){return d(),g(this),!1})},a.fn.lightbox.parseJsonData=function(b){var c=[];return a.each(b,function(){c.push(Array(this.url,this.title))}),c},a.fn.lightbox.defaults={triggerEvent:"click",allSet:!1,fileLoadingImage:"images/loading.gif",fileBottomNavCloseImage:"images/closelabel.gif",overlayOpacity:.6,borderSize:10,imageArray:Array(),activeImage:null,imageScroll:!1,inprogress:!1,resizeSpeed:350,widthCurrent:250,heightCurrent:250,scaleImages:!1,xScale:1,yScale:1,displayTitle:!0,navbarOnTop:!1,displayDownloadLink:!1,slideNavBar:!1,navBarSlideSpeed:350,displayHelp:!1,strings:{help:" \u2190 / P - previous image\u00a0\u00a0\u00a0\u00a0\u2192 / N - next image\u00a0\u00a0\u00a0\u00a0ESC / X - close image gallery",prevLinkTitle:"previous image",nextLinkTitle:"next image",prevLinkText:"&laquo; Previous",nextLinkText:"Next &raquo;",closeTitle:"close image gallery",image:"Image ",of:" of ",download:"Download"},fitToScreen:!1,disableNavbarLinks:!1,loopImages:!1,imageClickClose:!0,jsonData:null,jsonDataParser:null}})(jQuery);
