task :default => :build

desc 'Clean up generated files'
task :clean do
  cleanup
end

desc 'Build the HTML site'
task :build => :clean do

  setup

  Dir["*.xml"].each do |file|
    #TODO get file basename
    command = "java -jar saxon/saxon9he.jar -o:_site/#{file}.html -xsl:generate_html.xsl #{file}"
    puts command 
  end
end

def jpegtran(directory, opts = "")
  begin
    command = "jpegtran -copy non -optimize -verbose"
    command += opts

    Dir["#{directory}/*.jpg"].each do |file|
      sh command + " -outfile " + file + " " + file
    end
  rescue
    puts "Install jpegtran: brew install jpegtran"
  end
end

def optipng(directory, opts = "")
  begin
    Dir["#{directory}/*.png"].each do |image|
      FileUtils.rm(image)
    end

    command = "optipng -dir #{directory} -o7 -q "
    command += opts

    Dir["images/*.png"].each do |image|
      sh command + image
    end
  rescue
    puts "Install optipng: brew install optipng"
  end
end

def setup
  FileUtils.mkdir_p('_site')
end

def cleanup
  FileUtils.rm_rf('_site')
end
